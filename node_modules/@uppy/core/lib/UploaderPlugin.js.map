{"version":3,"names":["BasePlugin","_queueRequestSocketToken","_classPrivateFieldLooseKey","UploaderPlugin","constructor","arguments","Object","defineProperty","writable","value","setQueueRequestSocketToken","fn","_classPrivateFieldLooseBase","uploadRemoteFile","file","options","serverToken","connectToServerSocket","abortOn","signal","uppy","getState","files","id","undefined","setFileState","getFile","err","_err$cause","cause","name","emit"],"sources":["UploaderPlugin.js"],"sourcesContent":["import BasePlugin from './BasePlugin.js'\n\nexport default class UploaderPlugin extends BasePlugin {\n  #queueRequestSocketToken\n\n  /** @protected */\n  setQueueRequestSocketToken (fn) {\n    this.#queueRequestSocketToken = fn\n  }\n\n  async uploadRemoteFile (file, options = {}) {\n    // TODO: we could rewrite this to use server-sent events instead of creating WebSockets.\n    try {\n      if (file.serverToken) {\n        return await this.connectToServerSocket(file)\n      }\n      const serverToken = await this.#queueRequestSocketToken(file).abortOn(options.signal)\n\n      if (!this.uppy.getState().files[file.id]) return undefined\n\n      this.uppy.setFileState(file.id, { serverToken })\n      return await this.connectToServerSocket(this.uppy.getFile(file.id))\n    } catch (err) {\n      if (err?.cause?.name === 'AbortError') {\n        // The file upload was aborted, itâ€™s not an error\n        return undefined\n      }\n\n      this.uppy.setFileState(file.id, { serverToken: undefined })\n      this.uppy.emit('upload-error', file, err)\n      throw err\n    }\n  }\n}\n"],"mappings":";;;AAAA,OAAOA,UAAU,MAAM,iBAAiB;AAAA,IAAAC,wBAAA,gBAAAC,0BAAA;AAExC,eAAe,MAAMC,cAAc,SAASH,UAAU,CAAC;EAAAI,YAAA;IAAA,SAAAC,SAAA;IAAAC,MAAA,CAAAC,cAAA,OAAAN,wBAAA;MAAAO,QAAA;MAAAC,KAAA;IAAA;EAAA;EAGrD;EACAC,0BAA0BA,CAAEC,EAAE,EAAE;IAC9BC,2BAAA,KAAI,EAAAX,wBAAA,EAAAA,wBAAA,IAA4BU,EAAE;EACpC;EAEA,MAAME,gBAAgBA,CAAEC,IAAI,EAAEC,OAAO,EAAO;IAAA,IAAdA,OAAO;MAAPA,OAAO,GAAG,CAAC,CAAC;IAAA;IACxC;IACA,IAAI;MACF,IAAID,IAAI,CAACE,WAAW,EAAE;QACpB,OAAO,MAAM,IAAI,CAACC,qBAAqB,CAACH,IAAI,CAAC;MAC/C;MACA,MAAME,WAAW,GAAG,MAAMJ,2BAAA,KAAI,EAAAX,wBAAA,EAAAA,wBAAA,EAA0Ba,IAAI,EAAEI,OAAO,CAACH,OAAO,CAACI,MAAM,CAAC;MAErF,IAAI,CAAC,IAAI,CAACC,IAAI,CAACC,QAAQ,CAAC,CAAC,CAACC,KAAK,CAACR,IAAI,CAACS,EAAE,CAAC,EAAE,OAAOC,SAAS;MAE1D,IAAI,CAACJ,IAAI,CAACK,YAAY,CAACX,IAAI,CAACS,EAAE,EAAE;QAAEP;MAAY,CAAC,CAAC;MAChD,OAAO,MAAM,IAAI,CAACC,qBAAqB,CAAC,IAAI,CAACG,IAAI,CAACM,OAAO,CAACZ,IAAI,CAACS,EAAE,CAAC,CAAC;IACrE,CAAC,CAAC,OAAOI,GAAG,EAAE;MAAA,IAAAC,UAAA;MACZ,IAAI,CAAAD,GAAG,qBAAAC,UAAA,GAAHD,GAAG,CAAEE,KAAK,qBAAVD,UAAA,CAAYE,IAAI,MAAK,YAAY,EAAE;QACrC;QACA,OAAON,SAAS;MAClB;MAEA,IAAI,CAACJ,IAAI,CAACK,YAAY,CAACX,IAAI,CAACS,EAAE,EAAE;QAAEP,WAAW,EAAEQ;MAAU,CAAC,CAAC;MAC3D,IAAI,CAACJ,IAAI,CAACW,IAAI,CAAC,cAAc,EAAEjB,IAAI,EAAEa,GAAG,CAAC;MACzC,MAAMA,GAAG;IACX;EACF;AACF"}