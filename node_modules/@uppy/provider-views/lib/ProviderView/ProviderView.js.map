{"version":3,"names":["h","PQueue","getSafeFileId","AuthView","Header","Browser","LoaderView","CloseWrapper","View","packageJson","getOrigin","location","origin","getRegex","value","RegExp","undefined","isOriginAllowed","allowedOrigin","patterns","Array","isArray","map","some","pattern","test","_updateFilesAndFolders","_classPrivateFieldLooseKey","ProviderView","constructor","plugin","opts","Object","defineProperty","_updateFilesAndFolders2","defaultOptions","viewType","showTitles","showFilter","showBreadcrumbs","filterQuery","bind","clearFilter","getFolder","getNextFolder","logout","handleAuth","handleScroll","donePicking","render","setPluginState","authenticated","files","folders","directories","filterInput","isSearchVisible","currentSelection","tearDown","id","name","setLoading","res","provider","list","updatedDirectories","state","getPluginState","index","findIndex","dir","slice","concat","title","username","_classPrivateFieldLooseBase","lastCheckbox","err","handleError","folder","requestPath","then","ok","revoked","message","uppy","i18n","url","manual_revoke_url","info","newState","catch","input","ensurePreAuth","authState","btoa","JSON","stringify","clientVersion","VERSION","link","authUrl","uppyVersions","authWindow","window","open","handleToken","e","source","log","companionAllowedHosts","data","parse","error","token","close","removeEventListener","setAuthToken","preFirstRender","addEventListener","event","path","nextPagePath","shouldHandleScroll","isHandlingScroll","response","recursivelyListAllFiles","queue","onFiles","curPath","items","filter","item","isFolder","promises","add","Promise","all","messages","newFiles","file","isEmpty","numNewFiles","concurrency","newFile","tagFile","getTagFile","checkIfFileAlreadyExists","push","numFiles","onIdle","smart_count","addFiles","forEach","clearSelection","viewOptions","_this","didFirstRender","targetViewOptions","loading","isChecked","toggleCheckbox","recordShiftKeyPress","filterItems","hasInput","headerProps","pluginIcon","icon","browserProps","showSearchFilter","search","clearSearch","searchTerm","searchOnInput","searchInputLabel","clearSearchLabel","noResultsLabel","done","cancel","cancelPicking","headerComponent","uppyFiles","getFiles","validateRestrictions","arguments","onUnmount","pluginName","i18nArray","version"],"sources":["ProviderView.jsx"],"sourcesContent":["import { h } from 'preact'\n// eslint-disable-next-line import/no-unresolved\nimport PQueue from 'p-queue'\n\nimport { getSafeFileId } from '@uppy/utils/lib/generateFileID'\n\nimport AuthView from './AuthView.jsx'\nimport Header from './Header.jsx'\nimport Browser from '../Browser.jsx'\nimport LoaderView from '../Loader.jsx'\nimport CloseWrapper from '../CloseWrapper.js'\nimport View from '../View.js'\n\nimport packageJson from '../../package.json'\n\nfunction getOrigin () {\n  // eslint-disable-next-line no-restricted-globals\n  return location.origin\n}\n\nfunction getRegex (value) {\n  if (typeof value === 'string') {\n    return new RegExp(`^${value}$`)\n  } if (value instanceof RegExp) {\n    return value\n  }\n  return undefined\n}\nfunction isOriginAllowed (origin, allowedOrigin) {\n  const patterns = Array.isArray(allowedOrigin) ? allowedOrigin.map(getRegex) : [getRegex(allowedOrigin)]\n  return patterns\n    .some((pattern) => pattern?.test(origin) || pattern?.test(`${origin}/`)) // allowing for trailing '/'\n}\n\n/**\n * Class to easily generate generic views for Provider plugins\n */\nexport default class ProviderView extends View {\n  static VERSION = packageJson.version\n\n  /**\n   * @param {object} plugin instance of the plugin\n   * @param {object} opts\n   */\n  constructor (plugin, opts) {\n    super(plugin, opts)\n    // set default options\n    const defaultOptions = {\n      viewType: 'list',\n      showTitles: true,\n      showFilter: true,\n      showBreadcrumbs: true,\n    }\n\n    // merge default options with the ones set by user\n    this.opts = { ...defaultOptions, ...opts }\n\n    // Logic\n    this.filterQuery = this.filterQuery.bind(this)\n    this.clearFilter = this.clearFilter.bind(this)\n    this.getFolder = this.getFolder.bind(this)\n    this.getNextFolder = this.getNextFolder.bind(this)\n    this.logout = this.logout.bind(this)\n    this.handleAuth = this.handleAuth.bind(this)\n    this.handleScroll = this.handleScroll.bind(this)\n    this.donePicking = this.donePicking.bind(this)\n\n    // Visual\n    this.render = this.render.bind(this)\n\n    // Set default state for the plugin\n    this.plugin.setPluginState({\n      authenticated: false,\n      files: [],\n      folders: [],\n      directories: [],\n      filterInput: '',\n      isSearchVisible: false,\n      currentSelection: [],\n    })\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  tearDown () {\n    // Nothing.\n  }\n\n  #updateFilesAndFolders (res, files, folders) {\n    this.nextPagePath = res.nextPagePath\n    res.items.forEach((item) => {\n      if (item.isFolder) {\n        folders.push(item)\n      } else {\n        files.push(item)\n      }\n    })\n\n    this.plugin.setPluginState({ folders, files })\n  }\n\n  /**\n   * Based on folder ID, fetch a new folder and update it to state\n   *\n   * @param  {string} id Folder id\n   * @returns {Promise}   Folders/files in folder\n   */\n  async getFolder (id, name) {\n    this.setLoading(true)\n    try {\n      const res = await this.provider.list(id)\n      const folders = []\n      const files = []\n      let updatedDirectories\n\n      const state = this.plugin.getPluginState()\n      const index = state.directories.findIndex((dir) => id === dir.id)\n\n      if (index !== -1) {\n        updatedDirectories = state.directories.slice(0, index + 1)\n      } else {\n        updatedDirectories = state.directories.concat([{ id, title: name }])\n      }\n\n      this.username = res.username || this.username\n      this.#updateFilesAndFolders(res, files, folders)\n      this.plugin.setPluginState({ directories: updatedDirectories, filterInput: '' })\n      this.lastCheckbox = undefined\n    } catch (err) {\n      this.handleError(err)\n    } finally {\n      this.setLoading(false)\n    }\n  }\n\n  /**\n   * Fetches new folder\n   *\n   * @param  {object} folder\n   */\n  getNextFolder (folder) {\n    this.getFolder(folder.requestPath, folder.name)\n    this.lastCheckbox = undefined\n  }\n\n  /**\n   * Removes session token on client side.\n   */\n  logout () {\n    this.provider.logout()\n      .then((res) => {\n        if (res.ok) {\n          if (!res.revoked) {\n            const message = this.plugin.uppy.i18n('companionUnauthorizeHint', {\n              provider: this.plugin.title,\n              url: res.manual_revoke_url,\n            })\n            this.plugin.uppy.info(message, 'info', 7000)\n          }\n\n          const newState = {\n            authenticated: false,\n            files: [],\n            folders: [],\n            directories: [],\n            filterInput: '',\n          }\n          this.plugin.setPluginState(newState)\n        }\n      }).catch(this.handleError)\n  }\n\n  filterQuery (input) {\n    this.plugin.setPluginState({ filterInput: input })\n  }\n\n  clearFilter () {\n    this.plugin.setPluginState({ filterInput: '' })\n  }\n\n  async handleAuth () {\n    await this.provider.ensurePreAuth()\n\n    const authState = btoa(JSON.stringify({ origin: getOrigin() }))\n    const clientVersion = `@uppy/provider-views=${ProviderView.VERSION}`\n    const link = this.provider.authUrl({ state: authState, uppyVersions: clientVersion })\n\n    const authWindow = window.open(link, '_blank')\n    const handleToken = (e) => {\n      if (e.source !== authWindow) {\n        this.plugin.uppy.log('rejecting event from unknown source')\n        return\n      }\n      if (!isOriginAllowed(e.origin, this.plugin.opts.companionAllowedHosts) || e.source !== authWindow) {\n        this.plugin.uppy.log(`rejecting event from ${e.origin} vs allowed pattern ${this.plugin.opts.companionAllowedHosts}`)\n      }\n\n      // Check if it's a string before doing the JSON.parse to maintain support\n      // for older Companion versions that used object references\n      const data = typeof e.data === 'string' ? JSON.parse(e.data) : e.data\n\n      if (data.error) {\n        this.plugin.uppy.log('auth aborted', 'warning')\n        const { uppy } = this.plugin\n        const message = uppy.i18n('authAborted')\n        uppy.info({ message }, 'warning', 5000)\n        return\n      }\n\n      if (!data.token) {\n        this.plugin.uppy.log('did not receive token from auth window', 'error')\n        return\n      }\n\n      authWindow.close()\n      window.removeEventListener('message', handleToken)\n      this.provider.setAuthToken(data.token)\n      this.preFirstRender()\n    }\n    window.addEventListener('message', handleToken)\n  }\n\n  async handleScroll (event) {\n    const path = this.nextPagePath || null\n\n    if (this.shouldHandleScroll(event) && path) {\n      this.isHandlingScroll = true\n\n      try {\n        const response = await this.provider.list(path)\n        const { files, folders } = this.plugin.getPluginState()\n\n        this.#updateFilesAndFolders(response, files, folders)\n      } catch (error) {\n        this.handleError(error)\n      } finally {\n        this.isHandlingScroll = false\n      }\n    }\n  }\n\n  async recursivelyListAllFiles (path, queue, onFiles) {\n    let curPath = path\n\n    while (curPath) {\n      const res = await this.provider.list(curPath)\n      curPath = res.nextPagePath\n\n      const files = res.items.filter((item) => !item.isFolder)\n      const folders = res.items.filter((item) => item.isFolder)\n\n      onFiles(files)\n\n      // recursively queue call to self for each folder\n      const promises = folders.map(async (folder) => queue.add(async () => (\n        this.recursivelyListAllFiles(folder.requestPath, queue, onFiles)\n      )))\n      await Promise.all(promises) // in case we get an error\n    }\n  }\n\n  async donePicking () {\n    this.setLoading(true)\n    try {\n      const { currentSelection } = this.plugin.getPluginState()\n\n      const messages = []\n      const newFiles = []\n\n      for (const file of currentSelection) {\n        if (file.isFolder) {\n          const { requestPath, name } = file\n          let isEmpty = true\n          let numNewFiles = 0\n\n          const queue = new PQueue({ concurrency: 6 })\n\n          const onFiles = (files) => {\n            for (const newFile of files) {\n              const tagFile = this.getTagFile(newFile)\n              const id = getSafeFileId(tagFile)\n              // If the same folder is added again, we don't want to send\n              // X amount of duplicate file notifications, we want to say\n              // the folder was already added. This checks if all files are duplicate,\n              // if that's the case, we don't add the files.\n              if (!this.plugin.uppy.checkIfFileAlreadyExists(id)) {\n                newFiles.push(newFile)\n                numNewFiles++\n                this.setLoading(this.plugin.uppy.i18n('addedNumFiles', { numFiles: numNewFiles }))\n              }\n              isEmpty = false\n            }\n          }\n\n          await this.recursivelyListAllFiles(requestPath, queue, onFiles)\n          await queue.onIdle()\n\n          let message\n          if (isEmpty) {\n            message = this.plugin.uppy.i18n('emptyFolderAdded')\n          } else if (numNewFiles === 0) {\n            message = this.plugin.uppy.i18n('folderAlreadyAdded', {\n              folder: name,\n            })\n          } else {\n            // TODO we don't really know at this point whether any files were actually added\n            // (only later after addFiles has been called) so we should probably rewrite this.\n            // Example: If all files fail to add due to restriction error, it will still say \"Added 100 files from folder\"\n            message = this.plugin.uppy.i18n('folderAdded', {\n              smart_count: numNewFiles, folder: name,\n            })\n          }\n\n          messages.push(message)\n        } else {\n          newFiles.push(file)\n        }\n      }\n\n      // Note: this.plugin.uppy.addFiles must be only run once we are done fetching all files,\n      // because it will cause the loading screen to disappear,\n      // and that will allow the user to start the upload, so we need to make sure we have\n      // finished all async operations before we add any file\n      // see https://github.com/transloadit/uppy/pull/4384\n      this.plugin.uppy.log('Adding remote provider files')\n      this.plugin.uppy.addFiles(newFiles.map((file) => this.getTagFile(file)))\n\n      this.plugin.setPluginState({ filterInput: '' })\n      messages.forEach(message => this.plugin.uppy.info(message))\n\n      this.clearSelection()\n    } catch (err) {\n      this.handleError(err)\n    } finally {\n      this.setLoading(false)\n    }\n  }\n\n  render (state, viewOptions = {}) {\n    const { authenticated, didFirstRender } = this.plugin.getPluginState()\n    const { i18n } = this.plugin.uppy\n\n    if (!didFirstRender) {\n      this.preFirstRender()\n    }\n\n    const targetViewOptions = { ...this.opts, ...viewOptions }\n    const { files, folders, filterInput, loading, currentSelection } = this.plugin.getPluginState()\n    const { isChecked, toggleCheckbox, recordShiftKeyPress, filterItems } = this\n    const hasInput = filterInput !== ''\n    const headerProps = {\n      showBreadcrumbs: targetViewOptions.showBreadcrumbs,\n      getFolder: this.getFolder,\n      directories: this.plugin.getPluginState().directories,\n      pluginIcon: this.plugin.icon,\n      title: this.plugin.title,\n      logout: this.logout,\n      username: this.username,\n      i18n,\n    }\n\n    const browserProps = {\n      isChecked,\n      toggleCheckbox,\n      recordShiftKeyPress,\n      currentSelection,\n      files: hasInput ? filterItems(files) : files,\n      folders: hasInput ? filterItems(folders) : folders,\n      username: this.username,\n      getNextFolder: this.getNextFolder,\n      getFolder: this.getFolder,\n\n      // For SearchFilterInput component\n      showSearchFilter: targetViewOptions.showFilter,\n      search: this.filterQuery,\n      clearSearch: this.clearFilter,\n      searchTerm: filterInput,\n      searchOnInput: true,\n      searchInputLabel: i18n('filter'),\n      clearSearchLabel: i18n('resetFilter'),\n\n      noResultsLabel: i18n('noFilesFound'),\n      logout: this.logout,\n      handleScroll: this.handleScroll,\n      done: this.donePicking,\n      cancel: this.cancelPicking,\n      headerComponent: Header(headerProps),\n      title: this.plugin.title,\n      viewType: targetViewOptions.viewType,\n      showTitles: targetViewOptions.showTitles,\n      showBreadcrumbs: targetViewOptions.showBreadcrumbs,\n      pluginIcon: this.plugin.icon,\n      i18n: this.plugin.uppy.i18n,\n      uppyFiles: this.plugin.uppy.getFiles(),\n      validateRestrictions: (...args) => this.plugin.uppy.validateRestrictions(...args),\n    }\n\n    if (loading) {\n      return (\n        <CloseWrapper onUnmount={this.clearSelection}>\n          <LoaderView i18n={this.plugin.uppy.i18n} loading={loading} />\n        </CloseWrapper>\n      )\n    }\n\n    if (!authenticated) {\n      return (\n        <CloseWrapper onUnmount={this.clearSelection}>\n          <AuthView\n            pluginName={this.plugin.title}\n            pluginIcon={this.plugin.icon}\n            handleAuth={this.handleAuth}\n            i18n={this.plugin.uppy.i18n}\n            i18nArray={this.plugin.uppy.i18nArray}\n          />\n        </CloseWrapper>\n      )\n    }\n\n    return (\n      <CloseWrapper onUnmount={this.clearSelection}>\n        {/* eslint-disable-next-line react/jsx-props-no-spreading */}\n        <Browser {...browserProps} />\n      </CloseWrapper>\n    )\n  }\n}\n"],"mappings":"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"}