{"version":3,"names":["h","useEffect","useState","useCallback","classNames","nanoid","getFileTypeIcon","ignoreEvent","FilePreview","RenderMetaFields","FileCard","props","_getMetaFields","uppy","files","fileCardFor","toggleFileCard","saveFileCard","metaFields","requiredMetaFields","openFileEditor","i18n","i18nArray","className","canEditFile","getMetaFields","file","computedMetaFields","showEditButton","storedMetaData","forEach","field","_file$meta$field$id","id","meta","formState","setFormState","handleSave","ev","preventDefault","updateMeta","newVal","name","handleCancel","emit","form","formEl","document","createElement","setAttribute","body","appendChild","addEventListener","removeEventListener","removeChild","onDragOver","onDragLeave","onDrop","onPaste","role","type","title","onClick","style","backgroundColor","color","event"],"sources":["index.jsx"],"sourcesContent":["import { h } from 'preact'\nimport { useEffect, useState, useCallback } from 'preact/hooks'\nimport classNames from 'classnames'\nimport { nanoid } from 'nanoid/non-secure'\nimport getFileTypeIcon from '../../utils/getFileTypeIcon.jsx'\nimport ignoreEvent from '../../utils/ignoreEvent.js'\nimport FilePreview from '../FilePreview.jsx'\nimport RenderMetaFields from './RenderMetaFields.jsx'\n\nexport default function FileCard (props) {\n  const {\n    uppy,\n    files,\n    fileCardFor,\n    toggleFileCard,\n    saveFileCard,\n    metaFields,\n    requiredMetaFields,\n    openFileEditor,\n    i18n,\n    i18nArray,\n    className,\n    canEditFile,\n  } = props\n\n  const getMetaFields = () => {\n    return typeof metaFields === 'function'\n      ? metaFields(files[fileCardFor])\n      : metaFields\n  }\n\n  const file = files[fileCardFor]\n  const computedMetaFields = getMetaFields() ?? []\n  const showEditButton = canEditFile(file)\n\n  const storedMetaData = {}\n  computedMetaFields.forEach((field) => {\n    storedMetaData[field.id] = file.meta[field.id] ?? ''\n  })\n\n  const [formState, setFormState] = useState(storedMetaData)\n\n  const handleSave = useCallback((ev) => {\n    ev.preventDefault()\n    saveFileCard(formState, fileCardFor)\n  }, [saveFileCard, formState, fileCardFor])\n\n  const updateMeta = (newVal, name) => {\n    setFormState({\n      ...formState,\n      [name]: newVal,\n    })\n  }\n\n  const handleCancel = () => {\n    uppy.emit('file-editor:cancel', file)\n    toggleFileCard(false)\n  }\n\n  const [form] = useState(() => {\n    const formEl = document.createElement('form')\n    formEl.setAttribute('tabindex', '-1')\n    formEl.id = nanoid()\n    return formEl\n  })\n\n  useEffect(() => {\n    document.body.appendChild(form)\n    form.addEventListener('submit', handleSave)\n    return () => {\n      form.removeEventListener('submit', handleSave)\n      document.body.removeChild(form)\n    }\n  }, [form, handleSave])\n\n  return (\n    <div\n      className={classNames('uppy-Dashboard-FileCard', className)}\n      data-uppy-panelType=\"FileCard\"\n      onDragOver={ignoreEvent}\n      onDragLeave={ignoreEvent}\n      onDrop={ignoreEvent}\n      onPaste={ignoreEvent}\n    >\n      <div className=\"uppy-DashboardContent-bar\">\n        <div className=\"uppy-DashboardContent-title\" role=\"heading\" aria-level=\"1\">\n          {i18nArray('editing', {\n            file: <span className=\"uppy-DashboardContent-titleFile\">{file.meta ? file.meta.name : file.name}</span>,\n          })}\n        </div>\n        <button\n          className=\"uppy-DashboardContent-back\"\n          type=\"button\"\n          form={form.id}\n          title={i18n('finishEditingFile')}\n          onClick={handleCancel}\n        >\n          {i18n('cancel')}\n        </button>\n      </div>\n\n      <div className=\"uppy-Dashboard-FileCard-inner\">\n        <div className=\"uppy-Dashboard-FileCard-preview\" style={{ backgroundColor: getFileTypeIcon(file.type).color }}>\n          <FilePreview file={file} />\n          {showEditButton\n            && (\n            <button\n              type=\"button\"\n              className=\"uppy-u-reset uppy-c-btn uppy-Dashboard-FileCard-edit\"\n              onClick={(event) => {\n                // When opening the image editor we want to save any meta fields changes.\n                // Otherwise it's confusing for the user to click save in the editor,\n                // but the changes here are discarded. This bypasses validation,\n                // but we are okay with that.\n                handleSave(event)\n                openFileEditor(file)\n              }}\n            >\n              {i18n('editFile')}\n            </button>\n            )}\n        </div>\n\n        <div className=\"uppy-Dashboard-FileCard-info\">\n          <RenderMetaFields\n            computedMetaFields={computedMetaFields}\n            requiredMetaFields={requiredMetaFields}\n            updateMeta={updateMeta}\n            form={form}\n            formState={formState}\n          />\n        </div>\n\n        <div className=\"uppy-Dashboard-FileCard-actions\">\n          <button\n            className=\"uppy-u-reset uppy-c-btn uppy-c-btn-primary uppy-Dashboard-FileCard-actionsBtn\"\n            // If `form` attribute is supported, we want a submit button to trigger the form validation.\n            // Otherwise, fallback to a classic button with a onClick event handler.\n            type=\"submit\"\n            form={form.id}\n          >\n            {i18n('saveChanges')}\n          </button>\n          <button\n            className=\"uppy-u-reset uppy-c-btn uppy-c-btn-link uppy-Dashboard-FileCard-actionsBtn\"\n            type=\"button\"\n            onClick={handleCancel}\n            form={form.id}\n          >\n            {i18n('cancel')}\n          </button>\n        </div>\n      </div>\n    </div>\n  )\n}\n"],"mappings":"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"}